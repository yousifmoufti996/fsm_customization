<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- FSM Order Stages -->
        
        <!-- Stage 1: On The Way / في الطريق -->
        <record id="fsm_stage_on_the_way" model="fsm.stage">
            <field name="name">في الطريق</field>
            <field name="sequence">101</field>
            <field name="stage_type">order</field>
        </record>
        

        <!-- Stage 2: Work in Progress / جاري العمل -->
        <record id="fsm_stage_work_in_progress" model="fsm.stage">
            <field name="name">جاري العمل</field>
            <field name="sequence">201</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 3: Postponed / مؤجل -->
        <record id="fsm_stage_postponed" model="fsm.stage">
            <field name="name">مؤجل</field>
            <field name="sequence">301</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 4: Marketing Follow-up / متابعة التسويق -->
        <record id="fsm_stage_marketing_followup" model="fsm.stage">
            <field name="name">متابعة التسويق</field>
            <field name="sequence">401</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 5: Sales Follow-up / متابعة المبيعات -->
        <record id="fsm_stage_sales_followup" model="fsm.stage">
            <field name="name">متابعة المبيعات</field>
            <field name="sequence">501</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 6: Waiting / في الانتظار -->
        <record id="fsm_stage_waiting" model="fsm.stage">
            <field name="name">في الانتظار</field>
            <field name="sequence">601</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 7: Cancelled / ملغي -->
        <record id="fsm_stage_cancelled" model="fsm.stage">
            <field name="name">ملغي</field>
            <field name="sequence">701</field>
            <field name="stage_type">order</field>
            <field name="is_closed">True</field>
        </record>

        <!-- Stage 8: Work Completion Request / طلب اتمام العمل -->
        <record id="fsm_stage_completion_request" model="fsm.stage">
            <field name="name">طلب اتمام العمل</field>
            <field name="sequence">801</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 9: Work Completed / تم العمل -->
        <record id="fsm_stage_work_completed" model="fsm.stage">
            <field name="name">تم العمل</field>
            <field name="sequence">901</field>
            <field name="stage_type">order</field>
            <field name="is_closed">True</field>
        </record>

        <!-- Stage 10: Audited / تم التدقيق -->
        <record id="fsm_stage_audited" model="fsm.stage">
            <field name="name">تم التدقيق</field>
            <field name="sequence">1001</field>
            <field name="stage_type">order</field>
            <field name="is_closed">True</field>
        </record>

        <!-- Stage 11: Emergency Stop / توقف طارئ -->
        <record id="fsm_stage_emergency_stop" model="fsm.stage">
            <field name="name">توقف طارئ</field>
            <field name="sequence">1101</field>
            <field name="stage_type">order</field>
        </record>
        <!-- Stage 12: postponed_request / طلب تأجيل -->
        <record id="fsm_stage_postponed_request" model="fsm.stage">
            <field name="name">طلب تأجيل</field>
            <field name="sequence">1102</field>
            <field name="stage_type">order</field>
        </record>
        
        <!-- Stage 13: Cancel Request / طلب الغاء -->
        <record id="fsm_stage_cancel_request" model="fsm.stage">
            <field name="name">طلب الغاء</field>
            <field name="sequence">1201</field>
            <field name="stage_type">order</field>
        </record>

        <!-- Stage 14: Emergency Stop Request / طلب توقف طارئ -->
        <record id="fsm_stage_emergency_stop_request" model="fsm.stage">
            <field name="name">طلب توقف طارئ</field>
            <field name="sequence">1301</field>
            <field name="stage_type">order</field>
        </record>



        <!-- Inherit FSM Order Form View to Add Stage Buttons -->
        <record id="fsm_order_form_stage_buttons" model="ir.ui.view">
            <field name="name">fsm.order.form.stage.buttons</field>
            <field name="model">fsm.order</field>
            <field name="inherit_id" ref="view_fsm_order_form_inherit_problem"/>
            <field name="arch" type="xml">
           
                <xpath expr="//group[@name='description_grp']" position="before">
                      <field name="user_is_callcenter" invisible="1"/>
                    <field name="fields_locked" invisible="1"/>
                    <field name="is_postponed" invisible="1"/>
                    <field name="is_work_in_progress" invisible="1"/>
                    <field name="is_on_the_way" invisible="1"/>
                    <field name="is_completion_request" invisible="1"/>
                    <field name="is_emergency_stop" invisible="1"/>
                    <field name="is_cancelled" invisible="1"/>
                    <field name="is_work_completed" invisible="1"/>
                    <field name="is_marketing_followup" invisible="1"/>
                    <field name="is_sales_followup" invisible="1"/>
                    <field name="is_waiting" invisible="1"/>
                    <field name="is_audited" invisible="1"/>
                    <field name="team_leader_id" invisible="1"/>
                    <field name="person_id" invisible="1"/>
                    <field name="manager_id" invisible="1" readonly="not (user_is_admin or user_is_manager)"/>
                    <field name="worker_id" invisible="1"/>
                    <field name="auditor_id" invisible="1"/>
                    <field name="is_postponed_request" invisible="1"/>
                    <field name="is_cancel_request" invisible="1"/>
                    <field name="is_emergency_stop_request" invisible="1"/>
                    <field name="user_is_sales_or_marketing" invisible="1"/>
                    <!-- Removed is_new_stage field -->
                    <field name="manager_user_is_current" invisible="1"/>
                    <field name="auditor_user_is_current" invisible="1"/>
                    <field name="team_leader_user_is_current" invisible="1"/>
                    
                </xpath>

                <xpath expr="//header" position="inside">
                    <field name="fields_locked" invisible="1"/> 
                    <field name="is_on_the_way" invisible="1"/> 
                    

                        <!-- Complete Button (hidden as per original) -->
                        <button name="action_complete" string="Complete" type="object" class="btn-success" invisible="1"/>

                        <!-- On The Way Button -->
                        <button name="action_set_on_the_way" string="في الطريق" type="object" class="btn-primary"
                            invisible="team_leader_user_is_current or not (is_waiting or is_postponed_request or is_cancel_request) or (manager_id and not manager_user_is_current and not user_is_admin)"/>

                       
                        <!-- Work in Progress Button (Visible to Team Leader only) -->
                        <button name="action_set_work_in_progress" string="جاري العمل"
                         type="object" class="btn-warning" invisible="not (team_leader_user_is_current or manager_user_is_current) or not (is_on_the_way or is_emergency_stop or is_postponed_request or is_cancel_request or is_waiting or is_completion_request) or not id"/>

                        <!-- Postponed Button -->
                        <button name="action_set_postponed" string="مؤجل" type="object" class="btn-secondary"
                            invisible="team_leader_user_is_current or not (is_waiting or is_marketing_followup or is_sales_followup or is_emergency_stop or is_postponed_request or is_cancel_request) or (manager_id and not manager_user_is_current and not user_is_admin)"/>

                        <!-- Marketing Follow-up Button -->
                        <button name="action_set_marketing_followup" string="متابعة التسويق" type="object" class="btn-info"
                            invisible="team_leader_user_is_current or not (is_waiting or is_postponed_request) or (manager_id and not manager_user_is_current and not user_is_admin)"/>

                        <!-- Sales Follow-up Button -->
                        <button name="action_set_sales_followup" string="متابعة المبيعات" type="object" class="btn-info"
                            invisible="team_leader_user_is_current or not (is_waiting or is_postponed_request) or (manager_id and not manager_user_is_current and not user_is_admin)"/>

                        <!-- Waiting Button -->
                        <button name="action_set_waiting" string="في الانتظار" type="object" class="btn-light"
                            invisible="team_leader_user_is_current or not (is_postponed or is_cancelled or is_marketing_followup or is_sales_followup or is_postponed_request or is_cancel_request) or not id or (manager_id and not manager_user_is_current and not user_is_admin) or not user_is_sales_or_marketing"
                            confirm="هل أنت متأكد من جعل هذا الطلب قيد الانتظار؟"/>

                        <!-- Cancelled Button -->
                        <button name="action_set_cancelled" string="الغاء الطلب" type="object" class="btn-danger"
                            invisible="team_leader_user_is_current or not (is_waiting or is_postponed or is_marketing_followup or is_sales_followup or is_emergency_stop or is_cancel_request)"
                            confirm="هل أنت متأكد من إلغاء هذا الطلب؟"/>

                        <!-- Completion Request Button (Visible to Team Leader only) -->
                        <button name="action_set_completion_request" string="طلب اتمام العمل" type="object" class="btn-primary"
                            invisible="not team_leader_user_is_current or not is_work_in_progress or not id"
                            confirm="هل تم إنجاز العمل بالفعل؟"/>

                         <!-- Work Completed Button -->
                        <button name="action_set_work_completed" string="تم العمل" type="object" class="btn-success" invisible="team_leader_user_is_current or not is_completion_request or not id or (auditor_id and not auditor_user_is_current and not user_is_admin and not user_is_manager)" confirm="هل تم إنجاز العمل بالفعل؟"/>


                        <!-- Audited Button -->
                        <button name="action_set_audited" string="تم التدقيق" type="object" class="btn-success"
                            invisible="team_leader_user_is_current or not (is_work_completed or is_cancelled) or not id or (auditor_id and not auditor_user_is_current and not user_is_admin)"
                            confirm="هل تم التدقيق على العمل؟"/>

                        <!-- Emergency Stop Button -->
                        <button name="action_set_emergency_stop" string="توقف طارئ" type="object" class="btn-danger"
                            invisible="team_leader_user_is_current or not (is_on_the_way or is_work_in_progress) or not id or (manager_id and not manager_user_is_current and not user_is_admin)"
                            confirm="هل تريد إيقاف هذا الطلب بشكل طارئ؟"/>

                        <!-- Postponed Request Button (Visible to Team Leader only) -->
                        <button name="action_set_postponed_request" string="طلب تأجيل" type="object" class="btn-danger"
                            invisible="not team_leader_user_is_current or not (is_on_the_way or is_work_in_progress) or not id"
                            confirm="هل تريد طلب تأجيل هذا الطلب؟"/>

                        <!-- Cancel Request Button (Visible to Team Leader only) -->
                        <button name="action_set_cancel_request" string="طلب الغاء" type="object" class="btn-danger"
                            invisible="not team_leader_user_is_current or not (is_on_the_way or is_work_in_progress) or not id"
                            confirm="هل تريد طلب إلغاء هذا الطلب؟"/>
                                                
                                        
                </xpath>
            </field>
        </record>

    </data>
</odoo>